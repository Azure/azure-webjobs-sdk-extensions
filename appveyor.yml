version: '{build}'
pull_requests:
  do_not_increment_build_number: true
image: Visual Studio 2017
branches:
  only:
  - master
  - dev
  - v2.x
clone_folder: c:\azure-webjobs-sdk-extensions
environment:
  BUILD_NUMBER: '%APPVEYOR_BUILD_NUMBER%'
  IncludeBuildNumberInVersion: 1
build_script:
- cmd: IF "%APPVEYOR_REPO_TAG_NAME%"=="" SET PackageSuffixCmd=/p:PackageSuffix=-%APPVEYOR_BUILD_NUMBER%
- cmd: msbuild "WebJobs.Extensions.proj" /target:EnableSkipStrongNames;TestBuild /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /property:BuildNumber=%APPVEYOR_BUILD_NUMBER%;Configuration=Release %PackageSuffixCmd%
before_test:
- ps: |
    # timer tests require Daylight Savings Time, so switch settings, then reset.
    $originalTZ = Get-TimeZone
    $env:ORIG_ID = $originalTZ.Id
    Write-Host "Current TimeZone: '$originalTZ'"
    Set-TimeZone -Name "Pacific Standard Time"
    $currentTZ = Get-TimeZone
    Write-Host "Changing TimeZone for Timer tests. Now '$currentTZ'"
after_test:
- ps: |
    Set-TimeZone -Id $env:ORIG_ID
    $currentTZ = Get-TimeZone
    Write-Host "Changing TimeZone back to original. Now '$currentTZ'"
artifacts:
- path: bin\Packages\*.*
  name: Packages